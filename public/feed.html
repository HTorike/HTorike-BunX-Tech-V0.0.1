<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BunX-Tech | Feed</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700&family=Space+Grotesk:wght@700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bun-pink: #ff43ad;
        }
        body { 
            background-color: #000; 
            font-family: 'Inter', sans-serif;
            /* Fundo radial sutil para profundidade */
            background: radial-gradient(circle at top center, #111 0%, #000 80%);
            color: #fff;
            min-height: 100vh;
        }
        /* ESTILO DO CARD CYBORG */
        .bun-card {
            /* Vidro escuro */
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px); /* Efeito de desfoque atr√°s do card */
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        /* Efeito ao passar o mouse */
        .bun-card:hover {
            border-color: rgba(255, 67, 173, 0.4); /* Borda rosa neon */
            box-shadow: 0 0 25px rgba(255, 67, 173, 0.1); /* Brilho sutil */
            transform: translateY(-2px); /* Leve levita√ß√£o */
        }
        .font-tech { font-family: 'Space Grotesk', sans-serif; }
    </style>
</head>
<body class="p-4 md:p-10 flex justify-center">

    <div class="w-full max-w-6xl flex flex-col md:flex-row gap-10">
        
        <main class="flex-1 max-w-2xl">
            <div class="mb-10 border-l-2 border-pink-500 pl-6">
                <h1 class="text-4xl font-tech font-bold italic tracking-tighter neon-glow">
                    bun<span class="text-pink-500">x</span>
                </h1>
                <p class="text-[10px] text-gray-500 uppercase tracking-[0.5em] mt-2">Sincroniza√ß√£o Ativa</p>
            </div>

            <section class="bun-card p-6 rounded-xl mb-10 border-l-4 border-pink-500">
                <textarea id="post-conteudo" class="w-full bg-transparent outline-none text-white placeholder-gray-600 resize-none h-20"placeholder="O que est√° acontecendo na rede"></textarea>
    
                <div class="flex justify-between items-center mt-4 border-t border-white/5 pt-4">
                    <span class="text-[9px] text-gray-500 uppercase tracking-widest">Criptografia: Ativa</span>
                    <button onclick="enviarPost()" 
                        class="bg-white text-black px-6 py-2 rounded-lg font-bold text-xs uppercase tracking-tighter hover:bg-pink-500 hover:text-white transition-all">
                        Transmitir
                    </button>
                </div>
            </section>

            <script>
                async function enviarPost() {
                    const conteudo = document.getElementById('post-conteudo').value;
                    const user = JSON.parse(localStorage.getItem('usuario'));

                    if (!user) return alert("Erro: Conex√£o perdida. Fa√ßa login novamente.");

                    const response = await fetch('/postar', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            usuario_id: user.id, // Pegamos o ID real do login!
                            conteudo: conteudo 
                        })
                    });

                    if (response.ok) {
                        document.getElementById('post-conteudo').value = '';
                        carregarFeed(); // Recarrega a lista na hora
                    }
                }
            </script>
            
            <div id="feed-container" class="space-y-6">
                </div>
        </main>

        <aside class="w-full md:w-80 space-y-4">
            <div class="sticky top-10">
                <h2 class="text-[10px] text-gray-600 uppercase tracking-widest mb-6 font-bold border-b border-white/5 pb-2">
                    M√≥dulos do Sistema
                </h2>

                <button class="w-full bun-card p-4 rounded-lg flex items-center justify-between group opacity-60 cursor-not-allowed">
                    <div class="flex items-center gap-3">
                        <span class="text-xl">üë•</span>
                        <span class="font-tech text-xs uppercase tracking-tighter">Conex√µes</span>
                    </div>
                    <span class="text-[9px] bg-white/10 px-2 py-1 rounded text-gray-400">OFFLINE</span>
                </button>

                <button class="w-full bun-card p-4 rounded-lg flex items-center justify-between group mt-3 opacity-60 cursor-not-allowed">
                    <div class="flex items-center gap-3">
                        <span class="text-xl text-purple-500">üéß</span>
                        <span class="font-tech text-xs uppercase tracking-tighter">Canais ativos</span>
                    </div>
                    <span class="text-[9px] border border-purple-500/50 text-purple-400 px-2 py-1 rounded">ENCRIPTADO</span>
                </button>

                <button class="w-full bun-card p-4 rounded-lg flex items-center justify-between group mt-3 opacity-60 cursor-not-allowed">
                    <div class="flex items-center gap-3">
                        <span class="text-xl text-pink-500">üí¨</span>
                        <span class="font-tech text-xs uppercase tracking-tighter">Mensagens</span>
                    </div>
                    <span class="text-[9px] text-pink-500 animate-pulse">LOCK</span>
                </button>

                <div class="mt-20 p-6 border-t border-white/10 text-center">
                    <div class="w-16 h-16 bg-gradient-to-br from-pink-500 to-purple-700 rounded-full mx-auto mb-4 blur-[1px] border-2 border-white/20"></div>
                    <p id="user-display" class="font-tech italic text-sm">Usu√°rio n√£o identificado</p>
                    <button onclick="localStorage.clear(); window.location.href='/login-page'" class="text-[9px] text-red-500 mt-4 uppercase tracking-widest hover:underline">Desconectar</button>
                </div>
            </div>
        </aside>

    </div>

    <script>
        // 1. Fun√ß√£o para criar o design do Card
        function criarCardHTML(post) {
            return `
                <article class="bun-card p-6 rounded-xl mb-4 border-l-2 border-transparent hover:border-pink-500">
                    <div class="flex justify-between items-start mb-4">
                        <div class="flex items-center space-x-3">
                            <div class="w-10 h-10 rounded-full bg-pink-500/10 border border-pink-500/20 flex items-center justify-center text-xl">ü§ñ</div>
                            <div>
                                <h3 class="font-bold text-pink-500 tracking-wide">${post.username}</h3>
                                <span class="text-[9px] text-gray-600 uppercase">BunX ID: #${post.usuario_id}</span>
                            </div>
                        </div>
                        <span class="text-[10px] text-gray-500 font-tech uppercase italic">${post.tempo_relativo}</span>
                    </div>
                    <p class="text-gray-300 leading-relaxed pl-14">${post.conteudo}</p>
                </article>
            `;
        }

        // 2. Fun√ß√£o para buscar dados da API e colocar na tela
        async function carregarFeed() {
            const container = document.getElementById('feed-container');
            try {
                const response = await fetch('/feed');
                const posts = await response.json();
                
                container.innerHTML = posts.length > 0 
                    ? posts.map(post => criarCardHTML(post)).join('')
                    : '<p class="text-center text-gray-600 py-10 uppercase text-xs tracking-[0.5em]">Nenhum sinal detectado na rede...</p>';
            } catch (e) {
                container.innerHTML = '<p class="text-red-500 text-center">Erro na sincroniza√ß√£o.</p>';
            }
        }

        // 3. Identifica√ß√£o do Usu√°rio na Sidebar
        const user = JSON.parse(localStorage.getItem('usuario'));
        if(user) {
            document.getElementById('user-display').innerText = user.username;
        }

        // Inicializa o feed ao abrir a p√°gina
        carregarFeed();
    </script>
</body>
</html>